<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Peer page</title>
    <script src="signalingChannelFactory.js"></script>
    <script src="sendForm.js"></script>
    <script src="peer.js"></script>
    <script language="javascript" type="text/javascript">
        window.addEventListener("load", function() {
            var peer = new Peer();

            peer.onChannelOpened = function(peerId, channel) {
              var titleRow = document.getElementById("title_row");
              var titleCell = titleRow.insertCell();
              titleCell.innerHTML = "Peer " + peerId;

              var sendRow = document.getElementById("send_row");
              var sendCell = sendRow.insertCell();
              sendCell.id = "send_" + peerId;

              createSendForm(peerId, sendCell.id, function onClick(message) {
                if (message.length > 0) {
                  channel.send(message);
                }
              });
            };

            peer.onMessageReceived = function(peerId, message) {
              var newText = document.createTextNode("from peer " + peerId + ": " + message);
              var paragraph = document.createElement("p");
              paragraph.appendChild(newText);

              var messages = document.getElementById("messages");
              messages.appendChild(paragraph);
            };

        }, false);
    </script>
</head>
<body>
    <h2>Peer page</h2>
    <table id="channels">
      <col width="160">
      <tr id="title_row"></tr>
      <tr id="send_row"></tr>
    </table>

    <h4>Messages received</h4>
    <div id="messages"></div>
</body>
</html>

